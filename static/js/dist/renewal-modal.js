!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=42)}({0:function(e,t,n){e.exports=n(30)},2:function(e,t){function n(e,t,n,r,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function c(e){n(o,a,i,c,s,"next",e)}function s(e){n(o,a,i,c,s,"throw",e)}c(void 0)}))}}},30:function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function c(e,t,n,r){var a=t&&t.prototype instanceof l?t:l,i=Object.create(a.prototype),o=new b(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return S()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var c=_(o,n);if(c){if(c===u)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,o),i}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function l(){}function d(){}function f(){}var p={};p[a]=function(){return this};var m=Object.getPrototypeOf,h=m&&m(m(x([])));h&&h!==t&&n.call(h,a)&&(p=h);var y=f.prototype=l.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function g(e,t){var r;this._invoke=function(a,i){function o(){return new t((function(r,o){!function r(a,i,o,c){var u=s(e[a],e,i);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,c)}),(function(e){r("throw",e,o,c)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,c)}))}c(u.arg)}(a,i,r,o)}))}return r=r?r.then(o,o):o()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function x(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=y.constructor=f,f.constructor=d,f[o]=d.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},v(g.prototype),g.prototype[i]=function(){return this},e.AsyncIterator=g,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new g(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(y),y[o]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;w(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},42:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(2),o=n.n(i);function c(){return(c=o()(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/advantage/renewals/".concat(t),{cache:"no-store"});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function s(){return(s=o()(a.a.mark((function e(t,n){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/advantage/renewals/".concat(t,"/invoices/").concat(n),{cache:"no-store",credentials:"include",method:"POST"});case 2:return r=e.sent,e.next=5,r.json();case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(){return(u=o()(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/advantage/renewals/".concat(t,"/process-payment"),{cache:"no-store",credentials:"include",method:"POST"});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(){return(l=o()(a.a.mark((function e(t,n,r,i,o){var c,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/advantage/customer-info",{method:"POST",cache:"no-store",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({payment_method_id:t,account_id:n,address:r,name:i,tax_id:o})});case 2:return c=e.sent,e.next=5,c.json();case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=["call_issuer","card_declined","do_not_honor","do_not_try_again","fraudulent","generic_decline","invalid_account","lost_card","merchant_blacklist","new_account_information_available","no_action_taken","not_permitted","pickup_card","restricted_card","revocation_of_all_authorizations","revocation_of_authorization","security_violation","service_not_allowed","stolen_card","stop_payment_order","transaction_not_allowed"],f=["card_velocity_exceeded","insufficient_funds","invalid_amount","withdrawal_count_limit_exceeded"],p=["incorrect_cvc","invalid_cvc","incomplete_cvc"],m=["incomplete_expiry","invalid_expiry_year","invalid_expiry_year_past","invalid_expiry_month_past"],h=["incorrect_number","invalid_number","incomplete_number"],y=["tax_id_invalid"],v=["incorrect_zip","incomplete_zip"],g=["invoice payment failed","payment method error","invalid customer information"];function _(e){var t=e.code,n={message:e.message,type:"notification"};return f.includes(t)||n.message.includes("Your card has insufficient funds")?n.message="That card doesn’t have enough funds to make this payment. Please contact your card issuer, or try a different card.":h.includes(t)?(n.message="That card number is incorrect. Check the number and try again.",n.type="card"):p.includes(t)?(n.message="That CVC number is incorrect. Check the number and try again.",n.type="card"):v.includes(t)?(n.message="That ZIP/postal code is incorrect. Check the code and try again.",n.type="card"):m.includes(t)?(n.message="That expiry date is incorrect. Check the date and try again.",n.type="card"):y.includes(t)?(n.message="That VAT number is invalid. Check the number and try again.",n.type="notification"):"card_not_supported"===t?(n.message="That card doesn’t allow this kind of payment. Please contact your card issuer, or try a different card.",n.type="notification"):"currency_not_supported"===t?(n.message="That card doesn’t allow payments in this currency. Please contact your card issuer, or try a different card.",n.type="notification"):"expired_card"===t?(n.message="That card has expired. Try a different card.",n.type="notification"):"testmode_decline"===t?(n.message="Test completed.",n.type="dialog"):d.includes(t)&&(n.message="Your card has been declined. Please contact your card issuer, or try a different card.",n.type="notification"),n}function L(e){var t,n,r,a="renewal is blocked"===e.code&&e.message.includes("already accepted: processing"),i="invoice payment failed"===e.code&&e.message.includes("Invoice is already paid"),o="invoice payment failed"===e.code&&e.message.includes("This payment requires additional user action"),c=(t=e.message,n=!1,["unexpected error setting customer payment method: ","unexpected error updating customer information: ","unexpected error creating customer: "].forEach((function(e){t.includes(e)&&(n=e)})),n);if(a||i||o)return!1;if("internal server error"===e.code&&c){var s=e.message.replace(c,"");r=_(JSON.parse(s))}else if(g.includes(e.code)){r=_(JSON.parse(e.message))}else r="validation_error"===e.type?_(e):"renewal is blocked"===e.code?{message:"Our Sales team will be in touch shortly to finalise this renewal. Your card has not been charged.",type:"dialog"}:null;return r}var w=["AL","AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","EL","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"],b={"uai-essential-desktop":"UA Infra Essential Desktop","uai-standard-desktop":"UA Infra Standard Desktop","uai-advanced-desktop":"UA Infra Advanced Desktop","uai-essential-physical-server":"UA Infra Essential Physical Server","uai-standard-physical-server":"UA Infra Standar Physical Server","uai-advanced-physical-server":"UA Infra Advance Physical Server","uai-essential-virtual-server":"UA Infra Essential Virtual Server","uai-standard-virtual-server":"UA Infra Standard Virtual Server","uai-advanced-virtual-server":"UA Infra Advanced Virtual Server"},x={visa:"832cf121-visa.png",mastercard:"83a09dbe-mastercard.png",amex:"91e62c4f-amex.png"};function S(e){var t=/[[\]']+/g,n="";if(t.test(e)){var r=e.replace(t,"").split(", "),a=[];r.forEach((function(e){e in b&&a.push(b[e])})),n=a.join(", ")}return n}function T(e,t,n){return new Intl.NumberFormat(n,{style:"currency",currency:t,currencyDisplay:"symbol"}).format(parseFloat(e/100)).replace(".00","")}function E(e,t){var n=function(e){var t=e.billing_details,n=e.card,r=n.exp_month.toString().padStart(2,"0"),a=n.exp_year.toString().slice(-2),i=n.brand.charAt(0).toUpperCase()+n.brand.slice(1);return{cardText:"".concat(i," ending ").concat(n.last4),cardExpiry:"".concat(r,"/").concat(a),cardImage:x[n.brand]||null,email:t.email,name:t.name}}(e),r=t.querySelector(".js-customer-card-expiry"),a=t.querySelector(".js-customer-card-brand"),i=t.querySelector(".js-customer-card"),o=t.querySelector(".js-customer-email"),c=t.querySelector(".js-customer-name");n.cardImage?(a.innerHTML='<img src="https://assets.ubuntu.com/v1/'.concat(n.cardImage,'" />'),a.classList.remove("u-hide")):a.classList.add("u-hide"),i.innerHTML=n.cardText,r.innerHTML=n.cardExpiry,c.innerHTML=n.name,o.innerHTML=n.email}function k(e,t){var n=function(e){var t=new Date(e.contractEnd),n=new Date(t.setDate(t.getDate()+1)),r={year:"numeric",month:"long",day:"numeric"};return{endDate:new Date(t.setMonth(t.getMonth()+parseInt(e.months))).toLocaleString("en-GB",r),name:"Renew &ldquo;".concat(e.name,"&rdquo;"),products:S(e.products),quantity:"".concat(e.quantity," &#215; ").concat(T(e.unitPrice,e.currency,"en-CA"),"/year"),startDate:n.toLocaleString("en-GB",r),total:T(e.total,e.currency,"en-US")}}(e),r=t.querySelector(".js-contract-name"),a=t.querySelector(".js-renewal-end"),i=t.querySelector(".js-product-name"),o=t.querySelector(".js-renewal-quantity"),c=t.querySelector(".js-renewal-start"),s=t.querySelector(".js-renewal-total");r.innerHTML=n.name,a.innerHTML=n.endDate,i.innerHTML=n.products,o.innerHTML=n.quantity,c.innerHTML=n.startDate,s.innerHTML=n.total}var I,j,q,M,P,O,H=document.getElementById("renewal-modal"),A=document.getElementById("details-form"),D=document.getElementById("payment-error-dialog"),C=document.getElementById("js-progress-indicator"),U=H.querySelector(".js-terms"),N=H.querySelector(".js-payment-method"),F=H.querySelector(".js-process-payment"),G=H.querySelector(".js-change-payment-method"),B=H.querySelector(".js-cancel-modal"),V=H.querySelector(".js-close-modal"),R=document.getElementById("card-errors"),Y=document.getElementById("renewal-errors"),z=window.Stripe(window.stripePublishableKey),J=z.elements({fonts:[{family:"Ubuntu",src:'url("https://assets.ubuntu.com/v1/e8c07df6-Ubuntu-L_W.woff2") format("woff2"), url("https://assets.ubuntu.com/v1/8619add2-Ubuntu-L_W.woff") format("woff")'}]}).create("card",{style:{base:{iconColor:"#e95420",color:"#111",fontWeight:300,fontFamily:'"Ubuntu", -apple-system, "Segoe UI", "Roboto", "Oxygen", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#666"},":-webkit-autofill":{color:"#666"}}}}),K={accountId:null,contractId:null,renewalId:null},W={name:null,email:null,country:null,address:null,tax:null},Z=!1,Q=!1,X=!1;function $(e){var t={line1:W.address,country:W.country},n=null;W.tax&&(n={value:W.tax,type:"eu_vat"}),function(e,t,n,r,a){return l.apply(this,arguments)}(e.id,K.accountId,t,W.name,n).then((function(t){!function(e,t){if(t.message){ce(L(t))}else t.createdAt?(E(e,H),de()):ce()}(e,t)})).catch((function(e){ce(L(e))}))}function ee(e){ue("exited payment modal (".concat(e,")")),A.reset(),J.clear(),le(),W={name:null,email:null,country:null,address:null,tax:null},fe()}function te(){clearTimeout(j),clearTimeout(q),clearTimeout(M),clearTimeout(P),se(),B.disabled=!1}function ne(e){N.disabled=!0,B.disabled=!0,F.disabled=!0,j=setTimeout((function(){C.classList.remove("u-hide"),q=setTimeout((function(){"payment"===e?C.querySelector("span").innerHTML="Making payment...":"payment_method"===e&&(C.querySelector("span").innerHTML="Checking details..."),M=setTimeout((function(){C.querySelector("span").innerHTML="Still trying...",P=setTimeout((function(){"payment"===e&&(location.search="subscription=".concat(K.contractId)),"payment_method"===e&&ce({message:"Sorry, your payment method can’t be set up at the moment. Try again in a few minutes.",type:"dialog"})}),15e3)}),11e3)}),2e3)}),2e3)}function re(e){"requires_payment_method"===e.pi_status?function(e,t){return s.apply(this,arguments)}(K.renewalId,e.invoice_id).then((function(e){ae(e)})).catch((function(e){console.error(e),oe()})):!function(e){if(e.pi_decline_code&&"authentication_required"===e.pi_decline_code)return!0;if("requires_action"===e.pi_status&&e.pi_secret)return!0;return!1}(e)?ce():(clearTimeout(I),se(),z.confirmCardPayment(e.pi_secret).then((function(e){var t;X=!0,(t=e).error?(ce({message:t.error.message,type:"notification"}),X=!1):(ne("payment"),oe())})))}function ae(e){if(e.code){var t=L(e);t?(ue("payment failed"),ce(t)):oe()}else oe()}function ie(){R.innerHTML="",R.classList.add("u-hide"),Y.querySelector(".p-notification__message").innerHTML="",Y.classList.add("u-hide")}function oe(){(function(e){return c.apply(this,arguments)})(K.renewalId).then((function(e){"done"!==e.status?function(e){var t,n,r;e.stripeInvoices&&(n=(t=e.stripeInvoices[e.stripeInvoices.length-1]).pi_status,r=t.subscription_status),!r||!n||"active"===r||X?(clearTimeout(I),I=setTimeout((function(){oe()}),3e3)):"active"!==r&&re(t)}(e):(ue("payment succeeded"),te(),C.querySelector(".p-icon--spinner").classList.add("u-hide"),C.querySelector(".p-icon--success").classList.remove("u-hide"),C.querySelector("span").innerHTML="Payment complete. One moment...",C.classList.remove("u-hide"),location.search="subscription=".concat(K.contractId))})).catch((function(e){console.error(e),ce()}))}function ce(e){e||(e={message:"Sorry, there was an unknown error with the payment. Check the details and try again. Contact <a href='https://ubuntu.com/contact-us'>Canonical sales</a> if the problem persists.",type:"notification"}),"card"===e.type?(R.innerHTML=e.message,R.classList.remove("u-hide"),le()):"notification"===e.type?(Y.querySelector(".p-notification__message").innerHTML=e.message,Y.classList.remove("u-hide"),le()):"dialog"===e.type?(D.innerHTML=e.message,te(),H.classList.remove("is-pay-mode","is-details-mode"),H.classList.add("is-dialog-mode"),N.disabled=!0,F.disabled=!0,U.checked=!1):console.error("invalid argument: ".concat(e))}function se(){C.querySelector(".p-icon--spinner").classList.remove("u-hide"),C.querySelector(".p-icon--success").classList.add("u-hide"),C.querySelector("span").innerHTML="",C.classList.add("u-hide")}function ue(e){dataLayer.push({event:"GAEvent",eventCategory:"advantage",eventAction:"renewal",eventLabel:e,eventValue:void 0})}function le(){te(),H.classList.remove("is-pay-mode","is-dialog-mode"),H.classList.add("is-details-mode"),N.disabled=!0,F.disabled=!0,U.checked=!1,J.focus(),pe()}function de(){ie(),te(),H.classList.remove("is-details-mode","is-dialog-mode"),H.classList.add("is-pay-mode"),N.disabled=!0,F.disabled=!0,U.checked=!1}function fe(){H&&H.classList.contains("p-modal")&&(H.classList.toggle("u-hide"),document.documentElement.classList.toggle("p-modal--active"))}function pe(){for(var e=A.elements,t=[Z],n=0;n<e.length;n++){var r=e[n].checkValidity();t.push(r)}t.includes(!1)?N.disabled=!0:N.disabled=!1}function me(e,t){var n=e.closest(".p-form-validation"),r=!1;if(n){var a=n.querySelector(".p-form-validation__message");e.checkValidity()?(n.classList.remove("is-error"),a.classList.add("u-hide"),a.innerHTML="",r=!0):t&&(n.classList.add("is-error"),a.classList.remove("u-hide"),a.innerHTML=e.validationMessage),pe()}return r}O=".js-renewal-cta",document.querySelectorAll(O).forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset;fe(),J.focus(),ue("opened payment modal"),K.accountId=t.accountId,K.contractId=t.contractId,K.renewalId=t.renewalId,k(t,H)}))})),function(){for(var e=H.querySelector("select"),t=H.querySelector(".js-vat-container"),n=0;n<A.elements.length;n++){var r=A.elements[n];r.addEventListener("input",(function(e){me(e.target,!1)})),r.addEventListener("blur",(function(e){me(e.target,!0)}))}A.addEventListener("submit",(function(e){e.preventDefault(),N.disabled||N.click()})),w.includes(e.value)?t.classList.remove("u-hide"):t.classList.add("u-hide"),e.addEventListener("change",(function(e){w.includes(e.target.value)?t.classList.remove("u-hide"):t.classList.add("u-hide")})),U.addEventListener("change",(function(){U.checked?F.disabled=!1:F.disabled=!0}))}(),N.addEventListener("click",(function(e){var t;e.preventDefault(),Q=!1,ue("submitted payment details"),t=new FormData(A),W.address=t.get("address"),W.email=t.get("email"),W.country=t.get("Country"),W.name=t.get("name"),W.tax=t.get("tax"),ne("payment_method"),z.createPaymentMethod({type:"card",card:J,billing_details:{name:W.name,email:W.email,address:{country:W.country,line1:W.address}}}).then((function(e){!function(e){if(e.paymentMethod)$(e.paymentMethod);else{var t=L(e.error);e.error.type,ce(t)}}(e)})).catch((function(e){console.error(e),te(),ce()}))})),F.addEventListener("click",(function(e){e.preventDefault(),ue("clicked 'Pay'"),ne("payment"),function(e){return u.apply(this,arguments)}(K.renewalId).then((function(e){ae(e)})).catch((function(e){console.error(e),ue("payment failed"),ce()}))})),G.addEventListener("click",(function(e){e.preventDefault(),Q=!0,J.clear(),le()})),B.addEventListener("click",(function(e){e.preventDefault(),Q?(Q=!1,A.elements.address.value=W.address,A.elements.Country.value=W.country,A.elements.email.value=W.email,A.elements.name.value=W.name,A.elements.tax.value=W.tax,de()):ee("clicked cancel")})),V.addEventListener("click",(function(e){e.preventDefault(),ee("clicked close")})),document.addEventListener("keyup",(function(e){"Escape"===e.key&&document.body.classList.contains("p-modal--active")&&ee("pressed escape key")})),J.mount("#card-element"),J.on("change",(function(e){if(e.error){var t=L(e.error);Z=!1,N.disabled=!0,ce(t)}else e.complete?(Z=!0,ie(),pe()):ie()})),pe()}});
//# sourceMappingURL=renewal-modal.js.map