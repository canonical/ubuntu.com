#!/bin/bash

while read local_ref local_sha remote_ref remote_sha
do
  if [ "$local_sha" = "0000000000000000000000000000000000000000000" ]; then
    continue
  fi

  if [ "$remote_sha" = "0000000000000000000000000000000000000000000" ]; then
    range="${local_sha}"
  else
    range="${remote_sha}..${local_sha}"
  fi

  changed_files=$(git diff --name-only "$range")

  echo "$changed_files" | grep -qE '\.scss$' && ! yarn lint-scss && exit 1
  echo "$changed_files" | grep -qE '\.js$'   && ! yarn lint-js && exit 1
  echo "$changed_files" | grep -qE '\.py$'   && ! yarn lint-python && exit 1
  echo "$changed_files" | grep -qE '\.html$' && ! ./scripts/djlint lint --cached && exit 1

done

exit 0

