{% extends "templates/base.html" %}

{% block title %}Activate Ubuntu Pro subscription{% endblock %}

{% block outer_content %}
  {% block content %}
  <section class="p-strip">
    <div class="u-fixed-width">
      <h2>Activate your Ubuntu Pro subscription</h2>
      <p>
        You are currently signed in as {{ name }}. Make sure it is the
        account you will be using to manage your subscription. If not, <a href="https://login.ubuntu.com/+login">log in
        to a different account</a>.
      </p>
      <p>
        Your product key should be in the confirmation email you received
        after buying your Ubuntu Pro Desktop subscription.
      </p>
      <p>The activation key is 23 characters long and starts with a K.</p>
      <form class="p-form p-form--inline" action="{{ url_for('pro_activate_activation_key') }}" method="POST">
        <div class="p-form__group">
          <label for="pro-activation-key" class="p-form__label">Enter your code</label>
          <div class="p-form__control is-error" style="min-width: 15rem">
            <input type="text" id="pro-activation-key" class="activate-input" name="pro-activation-key" autocomplete="off" placeholder="Ex: Kv4rKbprDZohbj-Giz9H9OQ" required="" aria-describedby="pro-activate-input">
            <p class="p-form-validation__message" id="pro-activatio-validation__message"></p>
          </div>
        </div>
        <button class="p-button--positive" type="submit" name="submit">Activate</button>
      </form>
    </div>
    {% if notification_message %}
    <div class="u-fixed-width">
      <div class="p-notification--{{ notification_class }}" id="notification">
        <div class="p-notification__content">
          <h5 class="p-notification__title">{{ notification_title }}</h5>
          <p class="p-notification__message">{{ notification_message }}</p>
        </div>
        <div class="p-notification__meta">
          <div class="p-notification__actions">
            {% if notification_message == "activation key already used" %}<a class="p-notification__action p-button" href="/pro/dashboard">Go to dashboard</a>{% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </section>
  <script>
    const activation_key = document.querySelector(".activate-input");
    const validate_message =  document.querySelector(".p-form-validation__message");

    function validateKey(e){
      const firsLetter = "The activation key starts with a K.";
      const length = "The activation key is 23 characters long";
      const notification = document.querySelector("#notification");

      if(e.target.value.length === 0){
        validate_message.textContent = "";
      }else if(e.target.value.charAt(0) !== "K"){
        validate_message.textContent = firsLetter;
      } else if (e.target.value.length !== 23){
        validate_message.textContent = length;
      } else if(e.target.value.charAt(0) && e.target.value.length === 23) {
        validate_message.textContent = "";
      }
    }
    activation_key.addEventListener("keyup", validateKey);
  </script>
  {% endblock %}
{% endblock %}