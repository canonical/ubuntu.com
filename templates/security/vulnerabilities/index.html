{% extends "security/base_security.html" %}

{% block title %}Vulnerabilities{% endblock %}

{% block meta_description %}{% endblock %}

{% block meta_copydoc %}

{% endblock meta_copydoc %}

{% block body_class %}
  is-paper
{% endblock body_class %}

{% block content %}
  <div class="p-section--hero">
    <div class="row--25-75">
      <div class="col">
        <h1 class="p-heading--2">Vulnerabilities knowledge base</h1>
        <p>
          Applying security updates in a timely manner is critical to reducing risks, especially with high-impact vulnerabilities. Canonical releases <a href="/security/notices">Ubuntu Security Notices</a> whenever a security fix is available for an official Ubuntu package.
        </p>
        <p>
          When high-profile vulnerabilities are publicly disclosed, the Ubuntu Security Team also provides in-depth technical explanations and mitigation guidance in the form of Vulnerability Knowledge Base articles.
        </p>
      </div>
    </div>
  </div>

  <div class="p-section">
    <hr class="p-rule is-fixed-width" />
    <div class="row--25-75">
      <div class="col">
        <h2>Recent Vulnerabilities</h2>
      </div>
      <div class="col">
        {% set ns = namespace(previous_year=None, year_count=0) %}
        {% for vulnerability in vulnerabilities if vulnerability.name %}
          {% set is_new_year = vulnerability.year != ns.previous_year %}
          {% if is_new_year %}
            {% set ns.year_count = ns.year_count + 1 %}
          {% endif %}
          <div class="p-section--shallow {% if ns.year_count > 3 %}js-hide{% endif %}">
            {% if is_new_year %}<p class="p-heading--5">{{ vulnerability.year }}</p>{% endif %}
            {% set ns.previous_year = vulnerability.year %}
            <hr class="p-rule--muted u-no-margin--bottom" />
            <div class="row">
              <div class="col-6">
                <h3 class="p-heading--5 u-no-margin--bottom">
                  <a href="">{{ vulnerability.name }}</a>
                </h3>
                <p class="u-no-margin--bottom">{{ vulnerability.description }}</p>
              </div>
              <div class="col-3">
                {% if vulnerability.status|lower == "fixed" %}
                  <p class="u-no-margin--bottom u-sv1">
                    <i class="p-icon--success"></i>&nbsp;Fixed
                  </p>
                {% elif vulnerability.status|lower == "vulnerable" %}
                  <p class="u-no-margin--bottom u-sv1">
                    <i class="p-icon--error"></i>&nbsp;Vulnerable
                  </p>
                {% else %}
                  <p class="u-no-margin--bottom u-sv1">{{ vulnerability.status }}</p>
                {% endif %}
                <p class="u-text--muted">Published {{ vulnerability.published }}</p>
              </div>
            </div>
          </div>
        {% endfor %}
        <div class="p-cta-block u-hide js-toggle-visibility">
          <button class="p-button--positive"><span class="js-view-text">View all vulnerabilities</span><span class="js-hide-text u-hide">Hide vulnerabilities</span></button>
        </div>
      </div>
    </div>
  </div>

  <div class="p-section">
    <hr class="p-rule is-fixed-width" />
    <div class="row--25-75">
      <div class="col">
        <h2>Resources</h2>
      </div>
      <div class="col">
        <div class="row">
          <div class="col-3">
            <p class="p-heading--5">Ubuntu Security Updates</p>
          </div>
          <div class="col-6">
            <ul class="p-list--divided">
              <li class="p-list__item">
                <a href="/security/notices">Ubuntu Security Notices</a>
              </li>
              <li class="p-list__item">
                <a href="/security/cves">Database of known CVEs in Ubuntu</a>
              </li>
            </ul>
          </div>
        </div>
        <hr class="p-rule--muted" />
        <div class="row">
          <div class="col-3">
            <p class="p-heading--5">Ubuntu Pro</p>
          </div>
          <div class="col-6">
            <ul class="p-list--divided">
              <p>
                Up to 12 years of security coverage for Ubuntu
                and 36,000 open-source applications and toolchains.
              </p>
              <a class="p-button" href="pro">Get Ubuntu Pro</a>
            </ul>
          </div>
        </div>
        <hr class="p-rule--muted" />
        <div class="row">
          <div class="col-3">
            <p class="p-heading--5">From our blog</p>
          </div>
          <div class="col-6">
            <ul class="p-list--divided">
              <li class="p-list__item">
                <a href="/blog/what-is-vulnerability-management">What is vulnerability management?</a>
              </li>
              <li class="p-list__item">
                <a href="/blog/what-is-system-hardening-definition-and-best-practices">What is System Hardening? Essential Checklists from OS to Application</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function toggleVisibility() {
      const viewAllBtn = this;
      const hideText = document.querySelector(".js-hide-text");
      const viewText = document.querySelector(".js-view-text");
      const isExpanded = viewAllBtn.getAttribute("aria-expanded") === "true";
      const hiddenVulnerabilities = document.querySelectorAll(".js-hide");
      
      hiddenVulnerabilities.forEach(hiddenVulnerability => {
        hiddenVulnerability.classList.toggle("u-hide", isExpanded);
      });

      viewAllBtn.setAttribute("aria-expanded", !isExpanded);
      hideText.classList.toggle("u-hide", isExpanded)
      viewText.classList.toggle("u-hide", !isExpanded)
    }

    function setUpVulnerabilitiesVisibility() {
      const hiddenVulnerabilities = document.querySelectorAll(".js-hide");
      const viewAllCont = document.querySelector(".js-toggle-visibility");
      const viewAllBtn = viewAllCont.querySelector("button");

      // We hide/unhide at the start so if JS isn't enabled you can still see the vulnerabilities
      hiddenVulnerabilities.forEach(vulnerability => {
        vulnerability.classList.add("u-hide");
      });
      viewAllCont.classList.remove("u-hide");

      viewAllBtn.addEventListener("click", toggleVisibility);
    }
    setUpVulnerabilitiesVisibility();
  </script>
{% endblock content %}
