{% extends "security/cve/base_cve.html" %}

{% block title %}{{ cve.id }}{% endblock %}

{% block body_class %}is-paper{% endblock body_class %}

{% block content %}

{% if cve.impact %}
 {% set cvssV3 = cve.impact.baseMetricV3.cvssV3 %}
{% endif %}

<section class="p-strip is-shallow u-no-padding--bottom">
  <div class="row p-section">
    <div class="col-start-large-4 col-9">
      <h1>{{ cve.id }}</h1>
      {% if cve.codename %}
      <p class="u-cve-gap">
        <span>Name</span><span>{{ cve.codename }}</span>
      </p>
      {% endif %}

      {% if cve.published %}
        <p class="u-cve-gap">Publication date <span>{{ cve.published }}</span></p>
      {% endif %}

      {% if cve.updated_at %}
        <p class="u-cve-gap">Last updated <span>{{ cve.updated_at }}</span></p>
      {% endif %}

      <hr class="p-rule" />
      {% if cve.priority or cvssV3 %}
        <div class="row" style="display: flex; gap: 9%;">
          {% if cve.priority %}
            <div class="">
              <p class="p-text--small-caps">Ubuntu priority</p>
              <div class="p-heading-icon--small">
                <div class="p-heading-icon__header p-section--shallow">
                  {% if cve.priority == 'unknown' %}
                    <img src="https://assets.ubuntu.com/v1/2dff197f-CVE-Priority-icon-Unknown.svg" alt="" class="p-heading-icon__img">
                  {% endif %}
      
                  {% if cve.priority == 'negligible' %}
                    <img src="https://assets.ubuntu.com/v1/ef6c75b8-CVE-Priority-icon-Negligible.svg" alt="" class="p-heading-icon__img">
                  {% endif %}
      
                  {% if cve.priority == 'low' %}
                    <img src="https://assets.ubuntu.com/v1/03ac6f86-CVE-Priority-icon-Low.svg" alt="" class="p-heading-icon__img">
                  {% endif %}
      
                  {% if cve.priority == 'medium' %}
                    <img src="https://assets.ubuntu.com/v1/8010f9e0-CVE-Priority-icon-Medium.svg" alt="" class="p-heading-icon__img">
                  {% endif %}
      
                  {% if cve.priority == 'high' %}
                    <img src="https://assets.ubuntu.com/v1/3887354e-CVE-Priority-icon-High.svg" alt="" class="p-heading-icon__img">
                  {% endif %}
      
                  {% if cve.priority == 'critical' %}
                    <img src="https://assets.ubuntu.com/v1/c96f27b9-CVE-Priority-icon-Critical.svg" alt="" class="p-heading-icon__img">
                  {% endif %}
                  <p class="p-heading-icon__title u-no-margin--bottom p-heading--4">
                    <strong>{{ cve.priority | capitalize }}</strong>
                  </p>
                </div>
                <p><a>Why this priority?</a></p>
              </div>
            </div>
          {% endif %}
          
          {% if cvssV3 %}
            <div class="">
              <h2 class="p-text--small-caps">Cvss 3 Severity Score</h2>
              <div class="p-heading-icon--small">
                <div class="p-heading-icon__header p-section--shallow">
                  <img src="https://assets.ubuntu.com/v1/8010f9e0-CVE-Priority-icon-Medium.svg" alt="" class="p-heading-icon__img">
                  
                  <p class="p-heading-icon__title u-no-margin--bottom p-heading--4">
                    <strong>{{ cvssV3.baseScore | capitalize }}</strong>
                  </p>

                </div>
              </div>
              <p class="p-heading--5 u-no-margin--bottom"><a href="#impact-score">Score breakdown</a></p>
            {% elif cve.cvss3 %}
                <p>CVSS 3 base score: {{ cve.cvss3 }} Medium</p>
            </div>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</section>

<section class="p-section">
  <div class="row">
    <aside class="col-3">
      <div class="p-side-navigation--raw-html is-sticky" id="drawer">
        <button class="p-side-navigation__toggle js-drawer-toggle" aria-controls="drawer">
          Toggle side navigation
        </button>
        <div class="p-side-navigation__overlay js-drawer-toggle" aria-controls="drawer"></div>
        <nav class="p-side-navigation__drawer" aria-label="documentation side navigation">
          <div class="p-side-navigation__drawer-header">
            <button class="p-side-navigation__toggle--in-drawer js-drawer-toggle" aria-controls="drawer">
              Toggle table of contents
            </button>
          </div>
          <ul>
            <li class="p-side-navigation__item">
              <a class="highlight-link is-active" href="#description">Description</a>
            </li>
            <li class="p-side-navigation__item">
              <a class="highlight-link" href="#mitigation">Mitigation</a>
            </li>
            <li class="p-side-navigation__item">
              <a class="highlight-link" href="#status">Status</a>
            </li>
            <li class="p-side-navigation__item">
              <a class="highlight-link" href="#impact-score">Severity score breakdown</a>
            </li>
            <li class="p-side-navigation__item">
              <a class="highlight-link" href="#references">References</a>
            </li>
          </ul>
        </nav>
      </div>
    </aside>
    
    <main class="col-9">
      <div class="p-section section-heading" id="description">
        {% if cve.description %}
          <p class=" u-no-padding--top">{{ cve.description }}</p>
        {% endif %}
  
        {% if cve.ubuntu_description %}
          <h2 class="p-heading--3">From the Ubuntu Security Team</h2>
          <p>{{ cve.ubuntu_description }}</p>
          <a href="#notes">Read the notes from the security team</a>
        {% endif %}
  
        <h3>Why is this CVE high priority?</h3>
        <p>By using unprivileged user namespaces, this can be exploited to achieve local privilege escalation.</p>  
      </div>

      {% if cve.mitigation %}
        <div class="p-section section-heading" id="mitigation">
          <h2>Mitigation</h2>
          <p>{{ cve.mitigation }}</p>
        </div>
      {% endif %}
      
      <div class="p-section section-heading" id="status">
        <h2>Status</h2>
        <div class="u-fixed-width p-section">
          <label class="p-switch" style="float: right;">
            <input type="checkbox" class="p-switch__input" role="switch">
            <span class="p-switch__slider"></span>
            <span class="p-switch__label">Show also unmaintained releases</span>
          </label>
        </div>

        {% if cve.status == 'active' %}
        <div class="row p-section--shallow">
          <div>
            <table class="cve-table">
              <thead>
                <tr>
                  <th style="width: 15rem;">Package</th>
                  <th>Ubuntu Release</th>
                  <th style="padding-left: 1.5rem;">Status</th>
                </tr>
              </thead>
              <tbody>
                {% for package in cve.packages %}
                  {% for status in package.statuses %}
                    <tr>
                      {% if status.release_codename %}
                        {% if loop.index == 1 %}
                          <td rowspan="{{ package.statuses | length }}">
                            {{ package["name"] }}
                          </td>
                        {% endif %}
                        <td>
                          {{ status.release_codename }}
                        </td>
                        
                        {% if status.status == "DNE" %}
                          <td class="u-text--muted" style="padding-left: 1.5rem;">  
                            Not in release
                        {% elif status.status == "not-affected" %}
                          <td class="u-text--muted" style="padding-left: 1.5rem;">  
                            Not affected
                        {% elif status.status == "needs-triage" %}
                          <td>
                          Needs triage
                        {% elif status.status == "needed" %}
                          <td>
                          Needed
                        {% elif status.status == "deferred" %}
                          <td>
                          Deferred
                        {% elif status.status == "ignored" %}
                          <td style="padding-left: 1.5rem;">
                          Ignored
                        {% elif status.status == "pending" %}
                          <td>
                          Pending
                        {% elif status.status == "released" %}
                        <td>

                        <i class="p-icon--success"></i> <span>Fixed</span>
                          {% if status.description %}
                            <span class="u-text--muted">{{ status.description }}</span>
                          {% endif %}
                        {% endif %}

                          {% if status.pocket == "esm-infra" %}
                            <a class="p-chip" href="/pro">
                              <span class="p-chip__value">Ubuntu pro</span>
                            </a>
                          {% endif %}
                          {% if status.pocket == "esm-apps" %}
                            <a class="p-chip" href="/pro">
                              <span class="p-chip__value"><small>Ubuntu pro</small></span>
                            </a>
                          {% endif %}
                        </td>
                      {% endif %}
                    </tr>
                  {% endfor %}
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% endif %}
        <hr class="is-muted"/>
        <p>
          <a style="margin-right: 1rem;">How can I get the fixes?</a>
          <a href="#patch-details">Patch details</a>
        </p>
      </div>

      <div class="p-section question-heading" id="#notes">
      </div>

      <div class="p-section" id="#patch-details">
        <h3>Patch details</h3>
        <div class="p-notification--information">
          <div class="p-notification__content">
            <p class="p-notification__message">For informational purposes only. We recommend not to cherry-pick updates. <a href="">How can I get the fixes?</a></p>
          </div>
        </div>
        <table>
          <thead>
            <tr>
              <th style="width: 19rem;">Package</th>
              <th>Patch details</th>
            </tr>
          </thead>
          <tbody>
            {% for package in cve.packages %}
              {% if package["name"] in patches|map(attribute="name")%}
                <tr>
                  <td> {{ package["name"] }} </td>
                  <td>
                    <ul class="p-list">
                    {% for patch in patches %}
                      {% if patch.name == package["name"]%}
                        {% if patch.type == "text" %}
                          <li class="p-list__item has-bullet">
                            {{ patch.content }}
                          </li>
                        {% elif patch.type == "break-fix" %}
                          <li class="p-list__item has-bullet">
                            Introduced by
                            <a href="https://git.kernel.org/linus/{{ patch.content.introduced }}">{{ patch.content.introduced }}</a>,
                            fixed by
                            <a href="https://git.kernel.org/linus/{{ patch.content.fixed }}">{{ patch.content.fixed }}</a>
                          </li>
                        {% elif patch.type == "link" %}
                          <li class="p-list__item has-bullet">
                            {{ patch.content.prefix | capitalize }}:
                            {% if patch.content.suffix %}
                            <a href="{{ patch.content.suffix }}">{{ patch.content.suffix }}</a>
                          </li>
                        {% else %}
                        <li class="p-list__item has-bullet">
                            {{ patch.content.suffix }}
                        </li>
                        {% endif %}
                      {% endif %}
                        {% endif %}                    
                      {% endfor %}
                    </ul>
                  </td>
                </tr>
              {% endif%}
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if cvssV3 %}
      <div class="p-section question-heading" id="impact-score">
        <div class="">
          <h2>Severity score breakdown</h2>
          <table>
            <thead>
              <tr>
                <th style="width: 17rem;">Parameter</th>
                <th class="u-align--left">Value</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>Base score</th>
                <td>{{cvssV3.baseScore}}</td>
              </tr>
              <tr>
                <th>Attack vector</th>
                <td>{{cvssV3.attackVector | capitalize}}</td>
              </tr>
              <tr>
                <th>Attack complexity</th>
                <td>{{cvssV3.attackComplexity | capitalize}}</td>
              </tr>
              <tr>
                <th>Privileges required</th>
                <td>{{cvssV3.privilegesRequired | capitalize}}</td>
              </tr>
              <tr>
                <th>User interaction</th>
                <td>{{cvssV3.userInteraction | capitalize}}</td>
              </tr>
              <tr>
                <th>Scope</th>
                <td>{{cvssV3.scope | capitalize}}</td>
              </tr>
              <tr>
                <th>Confidentiality</th>
                <td>{{cvssV3.confidentialityImpact | capitalize}}</td>
              </tr>
              <tr>
                <th>Integrity impact</th>
                <td>{{cvssV3.integrityImpact | capitalize}}</td>
              </tr>
              <tr>
                <th>Availability impact</th>
                <td>{{cvssV3.availabilityImpact | capitalize}}</td>
              </tr>
              <tr>
                <th>Vector</th>
                <td>{{cvssV3.vectorString}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}

      <div class="p-section section-heading" id="references">
        <h2>References</h2>
        <ul class="p-inline-list p-section--shallow">
          <li class="p-inline-list__item">
            <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name={{ cve.id }}">
              MITRE
            </a>
          </li>
          <li class="p-inline-list__item">
            <a href="https://nvd.nist.gov/vuln/detail/{{ cve.id }}">
              NVD
            </a>
          </li>
          <li class="p-inline-list__item">
            <a href="https://launchpad.net/bugs/cve/{{ cve.id }}">
              Launchpad
            </a>
          </li>
          <li class="p-inline-list__item">
            <a href="https://security-tracker.debian.org/tracker/{{ cve.id }}">Debian</a>
          </li>
        </ul>

        <h3>Related Ubuntu Security Notices (USN)</h3>
        <ul class="p-list">
          {% for notice in cve.notices %}
          <ul class="p-inline-list p-section--shallow">
            <li class="p-inline-list__item">
              <a href="https://usn.ubuntu.com/{{ notice.id }}">
                {{ notice.id }}
              </a>
            </li>
            <li class="p-inline-list__item">
              {{ notice.title }}
            </li>
            <li class="p-inline-list__item u-text--muted">
              {{ notice.published }}
            </li>
          </ul>
          {% endfor %}
        </ul>
      </div>
    </main>
  </div>
</section>

      {% if cve.status == 'active' and cve.notes %}
        <h2>Notes</h2>
        <table>
          <tr><th style="width: 10em;">Author</th><th>Note</th></tr>
          {% for note in cve.notes %}
          <tr>
            <td><a href="https://launchpad.net/~{{ note.author }}">{{ note.author }}</a></td>
            <td><pre>{{ note.note }}</pre></td>
          </tr>
          {% endfor %}
        </table>
      {% endif %}

<script>
   function setUpDynamicSideNav() {
    const sections = Array.prototype.slice.call(
      document.querySelectorAll(".section-heading")
    );

    const navigationLinks = Array.prototype.slice.call(
      document.querySelectorAll(".highlight-link")
    );

    sections.forEach(function(section) {
      const observer = new IntersectionObserver(function(entry) {
        if (entry[0].isIntersecting) {
          const sectionId = entry[0].target.id;
          navigationLinks.forEach(function(link) {
            if (link.getAttribute("href") === `#${sectionId}`) {
              link.classList.add("is-active");
            } else {
              link.classList.remove("is-active");
            }
          });
        }
      }, {
        rootMargin: "-200px 0px -400px",
        threshold: 0.5,
      });

      observer.observe(section);
    });
  };
  setUpDynamicSideNav();
</script>
{% endblock %}
