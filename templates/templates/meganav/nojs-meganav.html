{% set nav = get_meganav("all") %}

{% extends "templates/base.html" %}

{% block outer_content%}

<div class="p-strip nojs-meganav">
  {% for sections in nav %}
  <h2>{{sections}}</h2>
  <nav class="dropdown-window__content-container desktop-dropdown-content">
    <div class="dropdown-window__content">
      {% if "side_nav_sections" in nav[sections] %}
        <div class="dropdown-window__tab-panel">
          <div class="p-side-navigation is-dark">
            <div class="p-side-navigation__drawer">
              <ul class="p-side-navigation__list js-tabs u-no-margin--bottom js-tabbed-content" role="tablist" aria-label="Categories">
                {% for side_nav_section in nav[sections].side_nav_sections %}
                  <li class="p-side-navigation__item" data-id="{{id}}-{{format_to_id(side_nav_section.title)}}">
                    <a href="#" class="p-side-navigation__link js-tab {{ 'is-active' if loop.index == 1 }}" id="{{id}}-{{format_to_id(side_nav_section.title)}}-tab" aria-controls="{{id}}-{{format_to_id(side_nav_section.title)}}-tab-content" role="tab" aria-selected="{{ 'true' if loop.index == 1 else 'false' }}" onclick="toggleSection(event);">{{ side_nav_section.title }}</a>
                  </li>
                {% endfor %}
                </ul>
            </div>
          </div>
        </div>
        
        <div class="row u-no-padding">
          {% for side_nav_section in nav[sections].side_nav_sections %}
            <div class="col-12 dropdown-window__sidenav-content" {% if loop.index != 1 %}hidden="true"{% endif %} id="{{id}}-{{format_to_id(side_nav_section.title)}}-tab-content" tabindex="0" role="tabpanel" aria-labelledby="{{id}}-{{format_to_id(side_nav_section.title)}}-tab" >
              <div class="row u-no-padding"> 
                <div class="col-{% if side_nav_section.secondary_links %}8 is-bordered{% else %}12{% endif %} dropdown-window__main-panel">
                  {% for links_section in side_nav_section.primary_links %}
                    {% if links_section.title %}
                      <p class="p-muted-heading">{{ links_section.title }}</p>
                    {% endif %}
                    
                    <div class="row">
                      {% if side_nav_section.secondary_links %}
                        {% set split_links_list = split_list(links_section.links, 2) %}
                      {% else %}
                        {% set split_links_list = split_list(links_section.links, 3) %}
                      {% endif %}

                      <div class="col-4">
                        <ul class="p-list">
                          {% for link in split_links_list[0] %}
                            {% with 
                              url = link.url, 
                              title = link.title, 
                              description = link.description,
                              secondary_cta_url = link.secondary_cta_url,
                              secondary_cta_title = link.secondary_cta_title 
                            %}
                              {% include "templates/meganav/_list-item.html" %}
                            {% endwith %}
                          {% endfor %}
                        </ul>
                      </div>

                      <div class="col-4">
                        <ul class="p-list">
                          {% for link in split_links_list[1] %}
                            {% with 
                              url = link.url, 
                              title = link.title, 
                              description = link.description 
                            %}
                              {% include "templates/meganav/_list-item.html" %}
                            {% endwith %}
                          {% endfor %}
                        </ul>
                      </div>

                      {% if secondary_links not in side_nav_section %}
                        <div class="col-4">
                          <ul class="p-list">
                            {% for link in split_links_list[2] %}
                              {% with 
                                url = link.url, 
                                title = link.title, 
                                description = link.description 
                              %}
                                {% include "templates/meganav/_list-item.html" %}
                              {% endwith %}
                            {% endfor %}
                          </ul>
                        </div>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>      

                {% if side_nav_section.secondary_links %}
                <div class="col-4 dropdown-window__side-panel">
                  {% for links_section in side_nav_section.secondary_links %}
                    <p class="p-muted-heading">{{ links_section.title }}</p>
                    
                    <ul class="p-list">
                      {% for link in links_section.links %}
                        <li class="p-list__item">
                          <a href="{{ link.url }}">{{ link.title }}</a>
                        </li>
                      {% endfor %}
                    </ul>
                  {% endfor %}
                </div>
                {% endif %}
              </div>

              {% if side_nav_section.section_footer %}
                <div class="col-12 dropdown-window__footer">
                  {% if "copy" in side_nav_section.section_footer %}
                    <p>{{ side_nav_section.section_footer['copy'] }}</p>
                  {% endif %}

                  <a href="{{side_nav_section.section_footer['cta_url'] }}" class="p-button is-dark">{{ side_nav_section.section_footer['cta_title'] }}</a>
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% elif "primary_links" in nav[sections] %}
        <div class="row u-no-padding"> 
          <div class="col-9 dropdown-window__main-panel  {% if nav[sections].secondary_links or nav[sections].highlighted_secondary_links %}is-bordered{% endif %}">
            {% for links_section in nav[sections].primary_links %}
              {% if links_section.title %}
                <p class="p-muted-heading">{{ links_section.title }}</p>
              {% endif %}
              
              <div class="row">
                {% set split_links_list = split_list(links_section.links, 3) %}

                <div class="col-3">
                  <ul class="p-list">
                    {% for link in split_links_list[0] %}
                      {% with 
                        url = link.url, 
                        title = link.title, 
                        description = link.description,
                        secondary_cta_url = link.secondary_cta_url,
                        secondary_cta_title = link.secondary_cta_title 
                      %}
                        {% include "templates/meganav/_list-item.html" %}
                      {% endwith %}
                    {% endfor %}
                  </ul>
                </div>

                <div class="col-3">
                  <ul class="p-list">
                    {% for link in split_links_list[1] %}
                      {% with 
                        url = link.url, 
                        title = link.title, 
                        description = link.description 
                      %}
                        {% include "templates/meganav/_list-item.html" %}
                      {% endwith %}
                    {% endfor %}
                  </ul>
                </div>

                <div class="col-3">
                  <ul class="p-list">
                    {% for link in split_links_list[2] %}
                      {% with 
                        url = link.url, 
                        title = link.title, 
                        description = link.description 
                      %}
                        {% include "templates/meganav/_list-item.html" %}
                      {% endwith %}
                    {% endfor %}
                  </ul>
                </div>
              </div>
            {% endfor %}
          </div>      

          <div class="col-3 dropdown-window__side-panel">
            {% if nav[sections].secondary_links %}
              {% for links_section in nav[sections].secondary_links %}
                <p class="p-muted-heading">{{ links_section.title }}</p>
                
                <ul class="p-list">
                  {% for link in links_section.links %}
                    <li class="p-list__item">
                      <a href="{{ link.url }}">{{ link.title }}</a>
                    </li>
                  {% endfor %}
                </ul>
              {% endfor %}
            {% else %}
              {% for links_section in nav[sections].highlighted_secondary_links %}
                <p class="p-muted-heading" style="padding-left:0.5rem;">{{ links_section.title }}</p>
                <ul class="p-list">
                  {% for link in links_section.links %}
                    {% with 
                      url = link.url, 
                      title = link.title, 
                      description = link.description 
                    %}
                      {% include "templates/meganav/_list-item.html" %}
                    {% endwith %}
                  {% endfor %}
                </ul>
              {% endfor %}
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </nav>
  {% endfor %}
</div>

{% endblock %}