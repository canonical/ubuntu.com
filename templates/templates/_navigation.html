{% set breadcrumbs = get_navigation(request.path).breadcrumbs %}
<header id="navigation" class="p-navigation--sliding is-dark {% if breadcrumbs and breadcrumbs.children or breadcrumbs.grandchildren %}is-reduced {% elif breadcrumbs == 'tutorials' %}is-reduced{% endif %}">
  {% block header_banner %}
  <div class="row">
    <div class="p-navigation__banner col-3">
      <div class="p-navigation__tagged-logo">
        <a class="p-navigation__link {% if breadcrumbs and breadcrumbs.children or breadcrumbs.grandchildren %}u-no-padding--left {% elif breadcrumbs == 'tutorials' %}u-no-padding--left{% endif %}" href="/">
          {% if breadcrumbs and breadcrumbs.children or breadcrumbs.grandchildren %}
          Canonical Ubuntu
          {% elif breadcrumbs == "tutorials" %}
          Canonical Ubuntu
          {% else %}
          <div class="p-navigation__logo-tag">
            <img class="p-navigation__logo-icon" src="https://assets.ubuntu.com/v1/82818827-CoF_white.svg" alt="">
          </div>
          <span class="p-navigation__logo-title">Canonical Ubuntu</span>
          {% endif %}
        </a>
      </div>
      <ul class="p-navigation__items">
        <li class="p-navigation__item">
          <button class="js-search-button p-navigation__link--search-toggle" aria-label="Search">
          </button>
        </li>
        <li class="p-navigation__item">
          <button class="js-menu-button p-navigation__link">Menu</button>
        </li>
      </ul>
    </div>
    <nav class="p-navigation__nav col-9 js-show-nav u-hide" aria-label="Categories">
      <ul class="p-navigation__items">
        <li class="p-navigation__item--dropdown-toggle" role="menuitem" id="products" data-id="products" onmouseenter="fetchDropdown('/templates/meganav/products', 'products', event); this.onmouseenter = null;">
          <button class="p-navigation__link" href="#products-content" aria-controls="#products-content" tabindex="0" onfocus="fetchDropdown('/templates/meganav/products', 'products');">Products</button>
        </li>
        <li class="p-navigation__item--dropdown-toggle" role="menuitem" id="use-case" data-id="use-case" onmouseenter="fetchDropdown('/templates/meganav/use-case', 'use-case', event); this.onmouseenter = null;">
          <button class="p-navigation__link" href="#use-case-content" aria-controls="#use-case-content" tabindex="0" onfocus="fetchDropdown('/templates/meganav/use-case', 'use-case');">Use cases</button>
        </li>
        <li class="p-navigation__item--dropdown-toggle" role="menuitem" id="support" data-id="support" onmouseenter="fetchDropdown('/templates/meganav/support', 'support', event); this.onmouseenter = null;">
          <button class="p-navigation__link" href="#support-content" aria-controls="#support-content" tabindex="0" onfocus="fetchDropdown('/templates/meganav/support', 'support');">Support</button>
        </li>
        <li class="p-navigation__item--dropdown-toggle" role="menuitem" id="community" data-id="community" onmouseenter="fetchDropdown('/templates/meganav/community', 'community', event); this.onmouseenter = null;">
          <button class="p-navigation__link" href="#community-content" aria-controls="#community-content" tabindex="0" onfocus="fetchDropdown('/templates/meganav/community', 'community');">Community</button>
        </li>
        <li class="p-navigation__item--dropdown-toggle" role="menuitem" id="get-ubuntu" data-id="get-ubuntu" onmouseenter="fetchDropdown('/templates/meganav/get-ubuntu', 'get-ubuntu', event); this.onmouseenter = null;">
          <button class="p-navigation__link" href="#get-ubuntu-content" aria-controls="#get-ubuntu-content" tabindex="0" onfocus="fetchDropdown('/templates/meganav/get-ubuntu', 'get-ubuntu');">Get Ubuntu</button>
        </li>
        <li class="p-navigation__item--dropdown-toggle global-nav-mobile global-nav" role="menuitem" id="all-canonical" data-id="all-canonical"></li>
        <li class="p-navigation__item--dropdown-toggle js-account" role="menuitem" id="canonical-login" data-id="canonical-login"></li>
        <li class="p-navigation__item">
          <button href="#" class="js-search-button p-navigation__link--search-toggle"></button>
        </li>
      </ul>
      <div class="p-navigation__search">
        <form action="/search" class="p-search-box">
          <input type="search" class="p-search-box__input" name="q" placeholder="Search our sites" required="" aria-label="Search our sites">
          <button type="reset" class="p-search-box__reset"><i class="p-icon--close"></i></button>
          <button type="submit" class="p-search-box__button"><i class="p-icon--search"></i></button>
        </form>
      </div>
    </nav>
  </div>
  {% endblock header_banner %}
  <div class="p-navigation__search-overlay"></div>
</header>
<div class="dropdown-window-overlay fade-animation"></div>
<div class="dropdown-window slide-animation {% if breadcrumbs and breadcrumbs.children or breadcrumbs.grandchildren %}is-reduced {% elif breadcrumbs == 'tutorials' %}is-reduced{% endif %}">
  <div class="u-hide dropdown-content-desktop" id="products-content"></div>
  <div class="u-hide dropdown-content-desktop" id="use-case-content"></div>
  <div class="u-hide dropdown-content-desktop" id="support-content"></div>
  <div class="u-hide dropdown-content-desktop" id="community-content"></div>
  <div class="u-hide dropdown-content-desktop" id="get-ubuntu-content"></div>
  <div class="u-hide dropdown-content-desktop global-nav-desktop" id="all-canonical-content"></div>
</div>
{% if not(hide_subnav == True) %}
{% if breadcrumbs and breadcrumbs.children or breadcrumbs.grandchildren %}
<div id="secondary-navigation" class="p-navigation is-secondary is-dark">
  <div class="p-navigation__row">
    <div class="p-navigation__banner">
      <div class="p-navigation__tagged-logo">
        <a class="p-navigation__link" href="{{ breadcrumbs.section.path }}">
          <div class="p-navigation__logo-tag">
            <img class="p-navigation__logo-icon" src="https://assets.ubuntu.com/v1/82818827-CoF_white.svg" alt="">
          </div>
          <span class="p-navigation__logo-title">{{ breadcrumbs.section.title | replace(" ", "&nbsp;") | safe }}</span>
        </a>
      </div>
      {% if breadcrumbs.children %}
        {% if not (breadcrumbs.children | length == 1 and breadcrumbs.children[0].title == "Overview") %}
         <a href="#" class="p-navigation__toggle--open" title="Toggle navigation"><i class="p-icon--chevron-down is-light"></i></a>
        {% endif %}
      {% endif %}
    </div>

    <nav class="p-navigation__nav" aria-label="{{ breadcrumbs.section.title | replace(' ', '&nbsp;') | safe }} navigation">
      {% if breadcrumbs.children %}
      <ul class="p-navigation__items">
        {% for child in breadcrumbs.children %}
          {% if child.title != "Overview" %}
            {% if child.path == '/blog/topics' %}
            <li class="p-navigation__item  {% if child.active %}is-selected{% endif %}" style="position: relative;">
              <a aria-controls="#topics" data-trigger="hover" class="p-navigation__link  p-contextual-menu__toggle" href="#">{{ child.title }}</a>
              <span class="p-contextual-menu__dropdown" id="topics" aria-hidden="true" aria-label="submenu" style="position: absolute; font-size: .875rem;">
                <span class="p-contextual-menu__group">
                  {% for item in child.children %}
                  <a href="{{ item.path }}" class="p-contextual-menu__link breadcrumbs p-link--soft">{{ item.title }}</a>
                  {% endfor %}
                </span>
              </span>
            </li>
            {% elif child.path != '/blog/archives' and child.path != '/blog/upcoming' %}
            <li class="p-navigation__item {% if child.active %}is-selected{% endif %}">
              <a class="p-navigation__link" href="{{ child.path }}" {% if child.active %}aria-current="page"{% endif %}>{{ child.title }}</a>
            </li>
            {% endif %}
          {% endif %}
        {% endfor %}

        {% for child in breadcrumbs.children %}
          {% if child.path == "/blog/topics" %}
            {% for item in child.children %}
            <li class="p-navigation__item u-hide--medium u-hide--large {% if request.path == item.path %}is-selected{% endif %}">
              <a class="p-navigation__link" href="{{ item.path }}">{{ item.title }}</a>
            </li>
            {% endfor %}
          {% endif %}
        {% endfor %}
      </ul>
      {% endif %}
    </nav>
  </div>
</div>
{% endif %}
{% endif %}
