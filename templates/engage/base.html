{% set hide_nav = False %}

{% extends "engage/base_engage.html" %}

{% from "_macros/vf_hero.jinja" import vf_hero %}

{% set section_title = "Engage Page" %}
{% set section_path = "/engage" %}

{% block title %}{{ metadata['topic_name'] }}{% endblock %}

{% block meta_description %}{{ metadata['subtitle'] }}{% endblock %}

{% block meta_image %}{{ metadata['meta_image'] }}{% endblock %}

{% block head_extra %}
  {% if 'active' in metadata and metadata['active'] == "false" %}<meta name="robots" content="nofollow" />{% endif %}

  {# This is a hack to indicate to crawls to not index this page #}
  {% if metadata['path'] == "/engage/ShellOnboarding" %}<meta name="robots" content="noindex, nofollow" />{% endif %}

  <meta name="discourse-url" value="{{ metadata['topic_path'] }}" />

{% endblock %}

{% block meta_copydoc %}
  {{ metadata["meta_copydoc"] }}
{% endblock meta_copydoc %}

{% block content %}
  <div class="p-section--deep">
    <span id="publish_date" class="u-hide">{{ metadata["publish_date"] }}</span>
    <span id="created_date" class="u-hide">{{ metadata["created_at"] }}</span>

    <section class="p-engage-banner--dark">
      <section class="p-section--hero">
        <div class="row--50-50-on-large">
          <div class="col">
            <div class="p-section--shallow">
              <h1>{{ metadata["topic_name"] }}</h1>
              <p class="u-no-padding--top p-heading--4">{{ metadata['subtitle'] }}</p>
            </div>
            <div class="p-section--shallow">
              {% if ("primary_cta" in metadata) and (metadata["primary_cta"] != "") %}
                <p class="{% if ('show_cta_on_banner' in metadata) and (metadata["show_cta_on_banner"] == "true" ) %}u-show{% else %}u-hide{% endif %}">
                  <a href="{{ metadata['primary_link'] }}" class="p-button--positive">{{ metadata["primary_cta"] }}</a>
                  {% if ("secondary_cta" in metadata) and (metadata["primary_cta"] != "") %}
                    <a href="{{ metadata['secondary_link'] }}" class="p-button">{{ metadata['secondary_cta'] }}</a>
                  {% endif %}
                </p>
              {% endif %}
            </div>
          </div>
          <div class="col">
            <div class="p-image-container--3-2 u-hide--small u-hide--medium">
              <img src="{{ metadata['image'] }}"
                   alt=""
                   width="600px"
                   class="p-image-container__image" />
            </div>
          </div>
        </div>
      </section>
    </section>

    {% if metadata["webinar_date"] is defined %}
      {% if metadata["webinar_date"] | date_has_passed %}
        {% include "engage/shared/_webinar-embed.html" %}
      {% endif %}
    {% endif %}

    <section class="p-strip is-shallow u-text-max-width">
      <div class="row">
        <div class="{% if 'form_id' in metadata and metadata['form_id'] != '' %}col-7{% else %}col-12{% endif %}">
          {{ metadata["body_html"] | safe }}
        </div>
        {% if "form_id" in metadata and metadata["form_id"] != "" %}
          <div class="col-5" id="the-form">
            {% if metadata["language"] != '' %}
              {% set form = "engage/shared/_" + metadata["language"] + "_engage_form.html" %}
              {% if "form_cta" in metadata and metadata["form_cta"] != '' %}
                {% with id=metadata["form_id"], returnURL=metadata['path']+"/thank-you", cta=metadata['form_cta'] %}
                  {% include form %}
                {% endwith %}
              {% else %}
                {% with id=metadata["form_id"], returnURL=metadata['path']+"/thank-you" %}
                  {% include form %}
                {% endwith %}
              {% endif %}

            {% else %}
              {% if "form_cta" in metadata and metadata["form_cta"] != '' %}
                {% with id=metadata["form_id"], returnURL=metadata['path']+"/thank-you", cta=metadata['form_cta'] %}
                  {% include "engage/shared/_en_engage_form.html" %}
                {% endwith %}
              {% else %}
                {% with id=metadata["form_id"], returnURL=metadata['path']+"/thank-you" %}
                  {% include "engage/shared/_en_engage_form.html" %}
                {% endwith %}
              {% endif %}
            {% endif %}

          </div>
        {% endif %}
      </div>

    </section>

    {% if metadata["webinar_date"] is defined %}
      {% if not metadata["webinar_date"] | date_has_passed %}
        {% include "engage/shared/_webinar-embed.html" %}
      {% endif %}
    {% else %}
      {% include "engage/shared/_webinar-embed.html" %}
    {% endif %}

    {% if "youtube_id" in metadata %}
      <!-- Youtube webinars -->
      <section class="p-strip is-shallow" id="youtube-section">
        <div class="row" id="webinar">
          <iframe title="Webinar"
                  width="560"
                  height="315"
                  src="https://www.youtube.com/embed/{{ metadata['youtube_id'] }}"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
        </div>
      </section>
    {% endif %}

    {% if "vimeo_id" in metadata %}
      <!-- Vimeo webinars -->
      <section class="p-strip is-shallow" id="vimeo-section">
        <div class="row" id="webinar">
          <iframe title="Webinar"
                  src="https://player.vimeo.com/video/{{ metadata['vimeo_id'] }}"
                  width="560"
                  height="315"
                  frameborder="0"
                  allow="autoplay; fullscreen"
                  allowfullscreen></iframe>
        </div>
      </section>
    {% endif %}

    {% if related_pages_metadata %}
      <section class="p-section--shallow">
        <div class="row">
          <div class="col-8">
            <h5>Related posts</h5>
          </div>
        </div>

        <div class="row u-equal-height">
          {% for item in related_pages_metadata %}
            {% with
              title=item.topic_name,
              title_link=item.path,
              description=item.subtitle,
              type=item.type,
              thumbnail=item.meta_image,
              preview=preview,
              active=item.active,
              tags=item.tags
              %}
              {% include "engage/_article-card.html" %}
            {% endwith %}
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </div>
{% endblock content %}
